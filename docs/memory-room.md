# Room-Door Memory Maze (Working Title)

## 1. Game Overview

### Concept
3D 공간 기억력을 활용하는 퍼즐형 탐험 게임.  
플레이어는 여러 개의 방(Room)으로 이루어진 미로에서 **정답 루트(방의 순서)를 기억**하여 최종 출구까지 이동한다.

### Play Mode (Scope)
- MVP: **1인 플레이(Single-player)** 기준
- 추후 고도화 대비:
  - 라운드 상태/정답 경로/하이라이트는 `RoundId` 단위로 분리해 멀티 인스턴싱 가능하게 설계
  - 카메라 연출(Overview)은 클라이언트 전용 시스템으로 분리

### Genre
- Memory Puzzle
- Exploration
- First-Person / Third-Person 3D

### Target Experience
- 유치하지 않은 “게임다운” 퍼즐 경험
- 아이들과 함께 제작 및 플레이 가능
- 친구들에게 보여줄 수 있는 완성도

---

## 2. Core Gameplay Loop

1. Start Zone 진입
2. 카메라 Zoom-out Overview 표시
3. **정답 경로의 방(Room)들이 잠깐 Highlight**
4. 모든 Highlight 제거
5. 플레이어가 문을 통해 방 이동
6. **정해진 방 진입 순서(PathIndex)를 맞추며** 이동
7. `Goal` Room에 **올바른 순서로** 진입하면 성공
8. **오답 방 진입 시 실패 처리(패널티) 후 재도전**

---

## 3. Game World Structure

### Room (Node)

- 사각형 방 구조
- 각 방은 다음 정보를 가진다:

Attributes:
- RoomId
- IsStart
- IsGoal
- PathIndex (정답 경로에서 몇 번째 방인지. Start=0, Goal=Last. 경로에 없으면 오답)

구성 요소:
- Floor
- Walls
- Door Slots (N/E/S/W)

---

### Door (Connection)

- 두 Room 사이 연결 요소

Attributes:
- FromRoomId
- ToRoomId

States:
- Closed (CanCollide = true)
- Open (CanCollide = false)

Interaction:
- ProximityPrompt → Open Attempt

---

## 4. Movement Model

초기 버전:

- 문을 열면 걸어서 통과 가능
- (선택) 통과 시 Room Center로 Snap 이동
- Room 진입 판정(명시):
  - “중앙 도착”이 아니라 **방 영역에 들어오는 순간**을 진입으로 간주
  - 구현은 **방 바닥 면적**을 덮는 `RoomEntryTrigger`(투명/CanCollide=false) 파트를 Room 내부에 두고, 플레이어 `HumanoidRootPart`가 `Touched` 되면 Enter 처리
    - 권장: 벽/문 경계에서 오탐을 줄이기 위해 바닥보다 약간 안쪽으로 inset(여유) 적용
  - 디바운스: 이미 `CurrentRoomId`인 Room의 재-터치는 무시(중복 판정 방지)

---

## 5. Memory Mechanic

Round Start:

- Overview Camera 활성화
- **정답 경로 Room을 순서대로 Highlight(색 강조/Neon/Outline 등)**
  - 숫자 표시는 사용하지 않고, **1 → 2 → 3… 순서로 “불이 들어오는” 연출**로 순서를 전달
- (권장) 오버뷰 동안 플레이어 이동/문 상호작용 잠금(실수 방지)
- 3~5초 후 모든 Highlight 제거

Player Task:

- 기억한 **방의 순서/루트** 기반 이동

---

## 6. Failure / Penalty Design

옵션:

- **오답 Room 진입 시:**
  - 이전 Room으로 되돌림(텔레포트)
  - Time Penalty(추후)
  - (선택) HP/라이프 감소(추후) — MVP에서는 미사용(0)

초기 MVP:

- 오답 Room 진입 즉시 이전 Room으로 Teleport Back
- (선택) Time Penalty는 0부터 시작해서 난이도 파라미터로만 준비
- 진행 상태(권장/단순):
  - `CurrentCorrectPathIndex` = 마지막으로 “정답 순서로” 확정된 `PathIndex` (Start는 0으로 시작)
  - `ExpectedPathIndex` = `CurrentCorrectPathIndex + 1`
  - Room 진입 시:
    - `entered.PathIndex == ExpectedPathIndex` → `CurrentCorrectPathIndex += 1`
    - 그 외(오답/순서 불일치) → **진입을 인정하지 않고** 이전 Room으로 텔레포트(진행 인덱스 변화 없음)
  - 이유: 오답 Room은 “진행이 되돌아간 것”이 아니라 “진행이 확정되지 않은 시도”로 처리하는 편이 무한 루프/중복 판정을 피하기 쉬움
- 텔레포트 위치:
  - 이전 Room의 `RoomSpawn`(또는 Room center marker)로 이동하는 것을 기본으로 한다.
  - 텔레포트 직후 `RoomEntryTrigger` 재-터치로 연쇄 판정이 나지 않도록 짧은 쿨다운(예: 0.2s) 적용

---

## 7. MVP Level Layout

Rooms:

- R0 (Start)
- R1 (East)
- R2 (North-East)
- R3 (West)
- R4 (South)

Correct Path Example:

R0 → R1 → R2 → Exit

---

## 8. Level Generation Constraints (Grid)

- 방 배치는 **격자형(Grid)** 을 기본으로 한다.
  - 각 방은 N/E/S/W 인접 칸으로만 연결(= Door Slots 의미 고정)
  - 절대 좌표 배치가 아니라, `GridCoord(x, y)` 기반 생성/검증 가능하게 설계
- (참고) 초안 아이디어는 **허니콤(Hex/Honeycomb)** 이었으며, 추후 테마/룰 변형으로 확장 가능

---

## 9. Technical Architecture (Initial)

Modules:

- RoomGenerator
- DoorController
- RoundManager
- CameraDirector (Client)

Key Systems:

- Procedural Room Placement (Grid 기반)
- Correct Path Generation
- Door Interaction Logic
- Overview Camera System

---

## 10. Future Expansion Ideas

- Randomized Path Generation (Seed 기반)
- Multiple Keys / Fake Doors
- Timer Mode
- Score System
- More Rooms (7 → 9 → 12+)
- Theme Variants (Lab / Space / Dungeon)

---

## 11. Development Goal (Phase 1)

- Single Round Playable
- Rooms + Doors Generated by Code
- Correct Path Room Highlight
- Basic Failure Handling

Target Duration:

1–2 weeks prototype build

---

## 12. Difficulty / Replayability Params (Draft)

- `RoomCount`: 방 개수(예: 5 → 7 → 9+)
- `CorrectPathLength`: 정답 루트 길이(예: 3 → 4 → 5+)
- `BranchingFactor`: 방마다 선택지 수(가짜 경로 밀도)
- `HighlightDurationSec`: 오버뷰 하이라이트 노출 시간(예: 5 → 3 → 2)
- `HighlightStepSec`: 순서형 하이라이트에서 각 단계(방)마다 켜지는 시간(예: 0.6 → 0.4 → 0.25)
- `PenaltyTimeSec`: 오답 시 시간 패널티(초기 0)

---

## 13. Development Workflow (Studio-first, Debug-friendly)

### Goal
- 개발 경험이 없어도 **반복 테스트/디버그가 쉬운 방식**으로 MVP를 만든다.
- 오늘은 **수동 배치(Level을 Studio에서 직접 구성)** 로 시작하고, 로직이 안정화되면 RoomGenerator(코드 생성)로 확장한다.

### Working Style (추천)
- Roblox Studio에서 `Save to File`로 로컬 Place 파일(`.rbxl/.rbxlx`)을 먼저 만든다.
- 충분히 안정화되면 `Publish to Roblox`로 배포한다.

### Recommended Explorer Layout (MVP)
- `Workspace/Rooms` (Folder)
  - `Room_R0`, `Room_R1`... (Model)
    - `Floor`, `Walls`, `Doors...`
    - `RoomEntryTrigger` (Part: 바닥 면적, `Transparency=1`, `CanCollide=false`, `CanTouch=true`)
    - `RoomSpawn` (Part: 텔레포트/스폰 기준점)
- `Workspace/OverviewCamera` (Part, 선택: 오버뷰 고정 시점)
- `ServerScriptService/RoundManager` (Script)
- `ReplicatedStorage/Shared` (Folder: 상수/유틸/RemoteEvent 등 필요 시)
- `StarterPlayer/StarterPlayerScripts/CameraDirector` (LocalScript, 오버뷰 연출)

### Room Setup Checklist (수동 제작)
- 각 Room(Model)에 Attributes 설정:
  - `RoomId` (string)
  - `PathIndex` (number, Start=0, Goal=Last, 오답 방은 -1 권장)
  - `IsStart` (bool), `IsGoal` (bool)
- `RoomEntryTrigger`는 “문 앞”이 아니라 **방 바닥 면적을 덮는 트리거**로 두고, 경계 오탐을 줄이기 위해 약간 inset한다.
- `RoomSpawn`을 Room 내부 안전 위치에 둔다(벽/문과 겹치지 않게).

### Test & Debug (Studio)
- 기본 테스트: `Test > Play`(F5)로 1인 반복 실행
- Output 확인: `View > Output`을 켜고, 핵심 이벤트에 `print/warn` 로그를 남긴다.
- 오버뷰 시점 고정(권장): `OverviewCamera` 파트를 배치하고 `CameraDirector`가 해당 CFrame을 사용하도록 설정
- 추천 디버그 값(화면 표시):
  - `CurrentRoomId`
  - `CurrentCorrectPathIndex`
  - `ExpectedPathIndex`
  - `EnteredRoomId`, `EnteredPathIndex`
- 디버그 토글(권장):
  - `DEBUG_SHOW_TRIGGERS=true`일 때만 `RoomEntryTrigger.Transparency=0.7`로 보여주기
  - `DEBUG_SHOW_HIGHLIGHT=true`일 때 하이라이트/연출 강제 재생 버튼(테스트용) 제공

### Build Order (안전한 구현 순서)
1. Room 5개 수동 배치 + `RoomEntryTrigger`로 “진입 판정/되돌림/인덱스”부터 완성
2. 오버뷰 카메라 + “순서대로 불 들어오는 하이라이트” 추가
3. 문(프롬프트) 연동/연출 다듬기
4. RoomGenerator로 자동 생성 전환(마지막)

### Repo Helpers (선택)
- `memory-room/scripts/`에 Studio에 바로 복붙 가능한 스크립트 스캐폴딩을 둔다.
- `memory-room/README.md`에 Explorer 구조/복붙 위치/첫 테스트 루틴을 정리한다.
